---
- name: AgoraElections, Ensure using https in git clone
  sudo: true
  sudo_user: agoraelections
  shell: 'git config --global url."https://".insteadOf git://'
  # this is needed because otherwise when installing packages with pip
  # requirements from a git repository, it won't use the http_proxy if
  # configured, see:
  # http://stackoverflow.com/questions/128035/how-do-i-pull-from-a-git-repository-through-an-http-proxy/32744849#32744849
  # http://jgoodall.me/posts/2013/05/29/git-use-https/

- name: AgoraElections, installing admin requierements
  sudo: true
  sudo_user: agoraelections
  pip: virtualenv=/home/agoraelections/env state=present
       requirements=/home/agoraelections/agora-elections/admin/requirements.txt

- name: AgoraElections, resetting agora-tools virtualenv
  sudo: true
  sudo_user: agoraelections
  file:
    state=absent
    path=/home/agoraelections/.virtualenv/agora-tools

- name: AgoraElections, installing agora-tools requierements
  sudo: true
  sudo_user: agoraelections
  shell: "bash -c 'source /usr/share/virtualenvwrapper/virtualenvwrapper.sh && mkvirtualenv agora-tools -p $(which python3) && workon agora-tools && pip install -r /home/agoraelections/agora-tools/requirements.txt'"
