---
- name: Packages, Updating packages
  sudo: true
  action: apt update_cache=yes

- name: Packages, Installing packages
  sudo: true
  action: apt pkg={{item}} state=installed
  with_items:
    - git
    - htop
    - curl
    - postgresql
    - postgresql-server-dev-all
    - mercurial
    - nginx
    - supervisor
    - node
    - libffi-dev
    - virtualenvwrapper
    - libjpeg8-dev
    - libpq-dev
    - python-psycopg2
    - build-essential
    - python-dev
    - vim
    - libgmp-dev
    - make
    - m4

- name: Packages, Download python-pip & python3-pip from ubuntu vivid (needed for http_proxy)
  sudo: true
  get_url:
    url=http://es.archive.ubuntu.com/ubuntu/pool/universe/p/python-pip/{{item.pkg}}
    sha256sum={{item.sha256sum}}
    dest=/tmp/{{item.pkg}}
    validate_certs={{ not config.has_https_proxy }}
  with_items:
    - pkg: python3-pip_1.5.6-5ubuntu2_all.deb
      sha256sum: 126e4ca4bc1bdca44972307df95932071af4e5538f2160112de177e4de028623
    - pkg: python-pip_1.5.6-5ubuntu2_all.deb
      sha256sum: f879f8ba8b72dd76783c0c314c9e1052007526742ad755768f53966e86177350

- name: Packages, Install downloaded python-pip 1.5.6 & python3-pip 1.5.6
  sudo: true
  apt: deb=/tmp/{{item}}
  with_items:
    - python-pip_1.5.6-5ubuntu2_all.deb
    - python3-pip_1.5.6-5ubuntu2_all.deb

- name: Packages, Generate UTF-8 locales
  sudo: true
  shell: locale-gen en_US en_US.UTF-8 es_ES es_ES.UTF-8

- name: Packages, Configure locales
  sudo: true
  shell: dpkg-reconfigure locales

- name: Packages, Create postgresql cluster
  sudo: true
  shell: pg_createcluster --start -e UTF-8 --locale=UTF-8 --lc-collate=UTF-8 --lc-ctype=UTF-8 9.3 main
  register: cmdoutput
  failed_when: "'Error: cluster configuration already exists' not in cmdoutput.stderr and cmdoutput.rc != 0"

